rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Reglas para la carpeta de reportes PDF
    match /reports/{ot}/{filename} {
      // Validar que el nombre de archivo tenga extensión .pdf
      allow read: if false; // Bloquear lectura pública - solo acceso autenticado en el futuro
      
      // Permitir escritura solo para PDFs
      allow write: if request.resource.size < 10 * 1024 * 1024  // Máximo 10MB
                   && request.resource.contentType == 'application/pdf'
                   && filename.matches('.*\\.pdf$')
                   && ot.matches('\\d{5}(?:\\.\\d{2})?'); // Validar formato OT (5 dígitos + opcional .NN)
      
      // En el futuro, cuando se implemente autenticación, descomentar:
      // allow read: if request.auth != null;
      // allow write: if request.auth != null 
      //              && request.resource.size < 10 * 1024 * 1024
      //              && request.resource.contentType == 'application/pdf'
      //              && filename.matches('.*\\.pdf$')
      //              && ot.matches('\\d{5}(?:\\.\\d{2})?');
    }
    
    // Bloquear acceso a cualquier otra ruta
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
