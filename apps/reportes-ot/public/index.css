/**
 * Estilos globales reportes-ot.
 * Incluye reglas para saltos de página en protocolos (pantalla + PDF).
 */

:root {
  --protocol-page-header-space: 18mm;
  --protocol-page-footer-space: 8mm;
  /* Tamaño de checkboxes (edición, preview, PDF). Parametrizable: cambiar aquí para toda la app. */
  --protocol-checkbox-size: 16px;
}

/* Espacio reservado al inicio de cada página del protocolo */
.protocol-page-header-space {
  height: var(--protocol-page-header-space);
  min-height: var(--protocol-page-header-space);
}
/* Espacio reservado al final de cada página (evita contenido al borde inferior) */
.protocol-page-footer-space {
  height: var(--protocol-page-footer-space);
  min-height: var(--protocol-page-footer-space);
}

/* Durante generación de PDF: ocultar guías y overlays (html2canvas no respeta @media print) */
body.pdf-generating .page-break-guides {
  display: none !important;
}
body.pdf-generating .visual-page-break-indicator {
  display: none !important;
}

/* Preview/PDF: no partir tablas ni bloques de sección (tabla entera pasa a la página siguiente) */
.protocol-table-wrapper,
.protocol-section-block {
  break-inside: avoid;
  page-break-inside: avoid;
}
.protocol-table-wrapper {
  display: block;
}

/* Bordes más oscuros en headers/subheaders (fidelidad Word) */
.protocol-table-wrapper thead th,
.protocol-table-wrapper td.protocol-cell-header,
.protocol-table-wrapper td.protocol-cell-subheader {
  border-color: #94a3b8; /* slate-400 */
}

/* Título del test (header gris): 2 líneas, no invadir celda del checkbox (fidelidad Word) */
.protocol-cell-header-title {
  font-size: 11px !important;
  font-weight: 700 !important;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  white-space: pre-line !important;
  overflow: hidden;
  overflow-wrap: anywhere;
  word-break: break-word;
  padding-right: 12px !important;
}

/* thead: segunda columna "Ver especificación del cliente" — ancho mínimo, texto en una línea legible */
.protocol-th-ver-especificacion {
  min-width: 11rem !important;
  white-space: nowrap !important;
  word-break: normal !important;
}
.protocol-th-ver-especificacion span {
  white-space: nowrap !important;
  word-break: normal !important;
}

/* Celda derecha del header (checkbox + "Ver especificación del cliente"): ancho mínimo, una línea legible */
.protocol-header-checkbox-cell {
  text-align: right !important;
  min-width: 38mm !important;
  width: 38mm !important;
  vertical-align: middle !important;
}
.protocol-header-checkbox-cell label {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: flex-end !important;
  gap: 6px !important;
  width: 100%;
  white-space: nowrap !important;
  word-break: normal !important;
}
.protocol-header-checkbox-cell span {
  white-space: nowrap !important;
  word-break: normal !important;
  line-height: 1.25;
  font-size: 10px !important;
}

/* Barra gris continua: quitar línea vertical entre título y celda "Ver especificación" (fidelidad Word) */
.protocol-header-merge {
  border-right-color: transparent !important;
}

/* Fila header gris: más aire entre título (izq) y checkbox (der) */
.protocol-table-wrapper td.protocol-cell-header {
  padding-top: 6px;
  padding-bottom: 6px;
}

/* Detectores inline (VWD/MWD/DAD/RID): una fila horizontal, compacta como Word */
.protocol-table-wrapper td.protocol-cell-header .inline-detectors {
  justify-content: flex-start;
}
/* Inline detectores usan .protocol-checkbox (tamaño vía variable) */
.protocol-table-wrapper td.protocol-cell-header .inline-detectors input[type="checkbox"].protocol-checkbox {
  width: var(--protocol-checkbox-size);
  height: var(--protocol-checkbox-size);
  min-width: var(--protocol-checkbox-size);
  min-height: var(--protocol-checkbox-size);
}
.protocol-table-wrapper td.protocol-cell-header .inline-detectors span {
  font-size: 10px;
}
.protocol-table-wrapper td.protocol-header-merge {
  padding-right: 14px !important; /* separa del bloque derecho */
}

/* Tres celdas vacías de la fila Cumple/No cumple/No aplica: sin bordes fuertes (fidelidad Word) */
.protocol-table-wrapper td.protocol-cell-note {
  border-right-color: transparent !important;
  border-left-color: transparent !important;
}

/* Checkbox de protocolo: tamaño vía --protocol-checkbox-size, alineación con el texto */
input[type="checkbox"].protocol-checkbox {
  width: var(--protocol-checkbox-size);
  height: var(--protocol-checkbox-size);
  min-width: var(--protocol-checkbox-size);
  min-height: var(--protocol-checkbox-size);
  vertical-align: middle;
  transform-origin: left center;
  flex-shrink: 0;
}
.protocol-table-wrapper input[type="checkbox"]:not(.protocol-checkbox) {
  width: var(--protocol-checkbox-size);
  height: var(--protocol-checkbox-size);
  min-width: var(--protocol-checkbox-size);
  min-height: var(--protocol-checkbox-size);
  vertical-align: middle;
  transform-origin: left center;
}

/* Celdas con checkbox centrado */
.protocol-checkbox-cell {
  text-align: center;
  vertical-align: middle;
}

.protocol-checkbox-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Celdas Conclusiones (Cumple/No cumple/No aplica): ancho fijo, checkbox centrado */
.protocol-cell-conclusiones {
  text-align: center;
  vertical-align: middle;
  min-width: 32px;
  width: 32px;
  padding: 2px !important;
  box-sizing: border-box;
}
.protocol-cell-conclusiones.protocol-checkbox-cell input[type="checkbox"] {
  margin: 0 auto;
  display: inline-block;
  vertical-align: middle;
}

/* Cada <table> y <tr> del protocolo: nunca cortar por la mitad */
.protocol-table-no-break,
.protocol-tr-no-break {
  break-inside: avoid;
  page-break-inside: avoid;
}

/* Evitar cortes dentro de tablas (Preview/PDF) */
.avoid-page-break {
  break-inside: avoid;
  page-break-inside: avoid;
}

/* Bloques atómicos en modo impresión: no partir tablas (Preview/PDF) */
.print-block.print-table-block {
  break-inside: avoid;
  page-break-inside: avoid;
}

@media print {
  .print-block.print-table-block,
  .print-avoid-break,
  .protocol-section,
  .protocol-table-wrapper,
  .protocol-section-block,
  .protocol-table-wrapper table {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
  .protocol-table-wrapper table,
  .protocol-table-wrapper tr {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
  .protocol-table-no-break,
  .protocol-tr-no-break {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
  /* Checkboxes: mismo tamaño en PDF (variable) */
  .protocol-table-wrapper input[type="checkbox"],
  input[type="checkbox"].protocol-checkbox {
    width: var(--protocol-checkbox-size) !important;
    height: var(--protocol-checkbox-size) !important;
    min-width: var(--protocol-checkbox-size) !important;
    min-height: var(--protocol-checkbox-size) !important;
    transform: none;
    transform-origin: left center;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Tablas: no partir */
  .avoid-page-break,
  .protocol-table-wrapper table,
  .protocol-table-wrapper tr {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
  .protocol-table-wrapper thead {
    display: table-header-group;
  }
  .protocol-table-wrapper tfoot {
    display: table-footer-group;
  }
}

/* Guías de corte A4: overlay, no afectan layout; ocultas al imprimir/generar PDF */
.page-break-guides {
  display: block;
  position: absolute;
  inset: 0;
  pointer-events: none;
}
@media print {
  .page-break-guides {
    display: none !important;
  }
}

/* Durante generación de PDF: sin scale para capturar A4 real */
body.pdf-generating .protocol-layout-paper {
  transform: none !important;
}
body.pdf-generating .protocol-screen-wrapper {
  overflow: visible !important;
}

/* Regla para html2pdf: forzar corte de página */
.break-before-page,
.html2pdf__page-break {
  page-break-before: always;
  break-before: page;
}

/* En pantalla: el marcador de salto no ocupa espacio; el separador visual (.visual-page-break-indicator) sí */
.html2pdf__page-break {
  height: 0;
  min-height: 0;
  overflow: hidden;
  display: block;
}

@media print {
  .break-before-page,
  .html2pdf__page-break {
    page-break-before: always !important;
    break-before: page !important;
    margin-top: 0 !important;
    padding: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
  }

  /* Ocultar el separador visual gris al imprimir/generar PDF */
  .visual-page-break-indicator {
    display: none !important;
    height: 0 !important;
    min-height: 0 !important;
    overflow: hidden !important;
    visibility: hidden !important;
  }
}

/* Divisor fijo Especificación | Conclusiones (a prueba de border-collapse / rowSpan) */
.protocol-table-wrapper td.protocol-conclusion-divider {
  border-left-width: 1px !important;
  border-left-style: solid !important;
  border-left-color: rgb(203 213 225) !important; /* slate-300 */
  box-shadow: inset 1px 0 0 rgb(203 213 225) !important; /* fallback si collapse "pierde" */
}
